<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://oliverneal.dev/oliver.webp" />
    <meta property="og:title" content="Minimalists – Codebase Breakdown" />
    <meta property="og:description" content="A cohesive, portfolio-styled breakdown of the Minimalists RTS codebase: architecture, data model, key APIs, representative snippets, and technical notes." />
    <meta property="og:url" content="https://oliverneal.dev/minimalists.html" />
    <title>Minimalists – Codebase Breakdown</title>
    <link rel="icon" href="oliver.webp" type="image/webp">

    <!-- Fonts & Prism (match portfolio) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" />
    <style>
        :root {
            --bg-color: #121212;
            --text-color: #e0e0e0;
            --accent-color: #FFA500;
            --secondary-color: #ff69b4;
            --header-bg: #222;
            --border-color: #444;
            --font-family: 'Roboto', sans-serif;
            --light-bg: #1e1e1e;
            --card-bg: #1e1e1e;
            --button-bg: #333;
            --button-hover-bg: #555;
            --button-text-color: #fff;
            --button-accent-text-color: #ffffff;
            --main-gradient: linear-gradient(90deg, #FFA500, #FF4500);
            --icon-color: #e0e0e0;
            --shadow-color: rgba(0, 0, 0, 0.5);
            --text-secondary-color: #aaa;
            --project-link-icon-filter: none;
            --link-icon-color: #e0e0e0;
            --message-box-bg: #2a2a2a;
            --message-box-border: #555;
            --message-box-text: #e0e0e0;
            --message-box-button-bg: #444;
            --message-box-button-hover-bg: #666;
            --message-box-overlay-bg: rgba(0, 0, 0, 0.7);
        }

        .light-theme {
            --bg-color: #ffffff;
            --text-color: #333333;
            --accent-color: #FFA500;
            --header-bg: #f5f5f5;
            --border-color: #ddd;
            --light-bg: #fefefe;
            --card-bg: #ffffff;
            --button-bg: #eee;
            --button-hover-bg: #ddd;
            --button-text-color: #333;
            --button-accent-text-color: #ffffff;
            --main-gradient: linear-gradient(90deg, #FFA500, #FF4500);
            --icon-color: #333333;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --text-secondary-color: #555;
            --project-link-icon-filter: none;
            --link-icon-color: #333333;
            --message-box-bg: #ffffff;
            --message-box-border: #ccc;
            --message-box-text: #333333;
            --message-box-button-bg: #eee;
            --message-box-button-hover-bg: #ddd;
            --message-box-overlay-bg: rgba(0, 0, 0, 0.5);
        }

        /* Base (match portfolio) */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            overflow-x: hidden;
            transition: background-color 0.3s ease, color 0.3s ease;
            /* Fix any halo/outline rendering in dark mode */
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }

        h1, h2, h3 {
            color: var(--text-color);
        }

        /* Remove any text-shadow that Prism/themes might add (fix white outline issue) */
        body, h1, h2, h3, p, a, li, code, pre, table, th, td {
            text-shadow: none !important;
            -webkit-text-stroke: 0 !important;
        }

            code[class*="language-"], pre[class*="language-"], .token {
                text-shadow: none !important;
            }

        /* Header / Nav (scoped to header to avoid doc-toc hover bug) */
        header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: var(--header-bg);
            color: var(--text-color);
            padding: 0.75rem 0;
            z-index: 999;
            box-shadow: 0 2px 4px var(--shadow-color);
            transition: background-color 0.3s ease;
        }

        .nav-container {
            width: 90%;
            max-width: 1100px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: nowrap;
        }

        .logo-and-icons {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-shrink: 0;
        }

        .nav-logo {
            font-size: 1.5rem;
            font-weight: bold;
            white-space: nowrap;
            color: var(--text-color);
        }

        .nav-icons {
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }

            .nav-icons a {
                display: block;
                width: 24px;
                height: 24px;
                line-height: 24px;
            }

            .nav-icons img {
                display: block;
                width: 24px;
                height: 24px;
                object-fit: contain;
                transition: opacity 0.2s ease, filter 0.3s ease;
            }

                .nav-icons img:hover {
                    opacity: 0.7;
                }

        .light-theme .nav-icons a[href*="github.com/OliverNealDev"] img {
            filter: invert(1);
        }

        header nav {
            margin-left: auto;
            margin-right: 1rem;
            text-align: right;
        }

            header nav ul {
                list-style: none;
                display: inline-flex;
                gap: 1.2rem;
                align-items: center;
                justify-content: flex-end;
                flex-wrap: nowrap;
                padding: 0;
                margin: 0;
            }

            header nav a {
                color: var(--text-color);
                text-decoration: none;
                font-weight: bold;
                transition: none;
                padding: 0.2rem 0;
                white-space: nowrap;
            }
                /* FIX: scope gradient hover to header nav only so doc-toc buttons don't turn transparent */
                header nav a.active-nav, header nav a:hover {
                    background: var(--main-gradient);
                    -webkit-background-clip: text;
                    background-clip: text;
                    -webkit-text-fill-color: transparent;
                    color: transparent;
                }

        .theme-toggle {
            flex-shrink: 0;
            display: flex;
            align-items: center;
        }

        .theme-checkbox {
            --toggle-size: 10px;
            appearance: none;
            width: 3.75em;
            height: 1.875em;
            background: linear-gradient(to right, #efefef 50%, #2a2a2a 50%) no-repeat;
            background-size: 205%;
            background-position: 0;
            transition: 0.4s;
            border-radius: 99em;
            position: relative;
            cursor: pointer;
            font-size: var(--toggle-size);
            border: 1px solid var(--border-color);
            display: block;
        }

            .theme-checkbox::before {
                content: "";
                width: 1.35em;
                height: 1.35em;
                position: absolute;
                top: 0.263em;
                left: 0.263em;
                background: linear-gradient(to right, #efefef 50%, #2a2a2a 50%) no-repeat;
                background-size: 205%;
                background-position: 100%;
                border-radius: 50%;
                transition: 0.4s;
                box-shadow: 0 1px 2px rgba(0,0,0,0.2);
            }

            .theme-checkbox:checked::before {
                left: calc(100% - 1.35em - 0.263em);
                background-position: 0;
            }

            .theme-checkbox:checked {
                background-position: 100%;
            }

        /* Main container (identical sizing) */
        main {
            width: 90%;
            max-width: 1100px;
            margin: 0 auto;
            padding-top: 100px;
        }

        /* Utility from portfolio */
        .reveal {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.8s ease-out, transform 0.8s ease-out;
            will-change: opacity, transform;
        }

            .reveal.visible {
                opacity: 1;
                transform: translateY(0);
            }

        /* Local page styles to match card look */
        .page-hero {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .breadcrumb {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary-color);
        }

            .breadcrumb a {
                color: var(--text-color);
                text-decoration: none;
                border-bottom: 1px dashed transparent;
            }

                .breadcrumb a:hover {
                    border-bottom-color: var(--accent-color);
                    background: var(--main-gradient);
                    -webkit-background-clip: text;
                    background-clip: text;
                    -webkit-text-fill-color: transparent;
                    color: transparent;
                }

        .page-title h1 {
            font-size: 2rem;
            margin: 0;
        }

        .page-sub {
            color: var(--text-secondary-color);
        }

        .doc-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 0.5rem;
        }

            .doc-actions a {
                display: inline-flex;
                align-items: center;
                gap: 6px;
                padding: 0.45rem 0.8rem;
                background: var(--button-bg);
                color: var(--button-text-color);
                text-decoration: none;
                border-radius: 4px;
                border: 1px solid transparent;
                font-size: 0.9rem;
            }

                .doc-actions a:hover {
                    background: var(--button-hover-bg);
                    border-color: var(--accent-color);
                }

            .doc-actions img, .doc-actions svg {
                width: 16px;
                height: 16px;
                vertical-align: middle;
            }

        .doc-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.25rem;
        }

        .doc-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: 0 2px 8px var(--shadow-color);
            padding: 1.25rem;
        }

            .doc-card h2 {
                font-size: 1.4rem;
                margin: 0 0 0.75rem 0;
                border-bottom: 2px solid var(--border-color);
                padding-bottom: 0.5rem;
            }

            .doc-card h3 {
                font-size: 1.1rem;
                margin: 1rem 0 0.5rem;
            }

        .doc-figure {
            margin: 0.75rem 0 0;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            overflow: hidden;
            background: #000;
        }

            .doc-figure img {
                width: 100%;
                height: auto;
                display: block;
            }

            .doc-figure figcaption {
                font-size: 0.9rem;
                color: var(--text-secondary-color);
                padding: 0.5rem 0.75rem;
                background: var(--header-bg);
                border-top: 1px solid var(--border-color);
            }

        /* Tables styled like site */
        .doc-table-wrapper {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 0.5rem;
            border: 1px solid var(--border-color);
        }

        th, td {
            padding: 0.75rem;
            text-align: left;
            border-top: 1px solid var(--border-color);
        }

        th {
            background: var(--light-bg);
            font-weight: 700;
        }

        tr:nth-child(even) td {
            background: rgba(255,255,255,0.02);
        }

        /* <details> */
        details {
            margin-top: 0.75rem;
        }

            details summary {
                cursor: pointer;
                font-weight: 600;
                background: var(--light-bg);
                padding: 0.6rem 0.75rem;
                border: 1px solid var(--border-color);
                border-radius: 6px;
            }

            details[open] summary {
                border-bottom-left-radius: 0;
                border-bottom-right-radius: 0;
            }

        /* Prism tweaks to match card bg */
        pre[class*="language-"] {
            background: var(--card-bg) !important;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            box-shadow: inset 0 0 0 rgba(0,0,0,0);
            padding: 1rem !important;
        }

        code[class*="language-"] {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
        }

        /* Section anchor bar (local TOC) */
        .doc-toc {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 0.6rem;
        }

            .doc-toc a {
                font-size: 0.9rem;
                text-decoration: none;
                color: var(--text-color);
                padding: 0.35rem 0.6rem;
                border-radius: 4px;
                border: 1px solid transparent;
                background: var(--button-bg);
            }

                .doc-toc a:hover {
                    background: var(--button-hover-bg);
                    border-color: var(--accent-color);
                }

        footer {
            text-align: center;
            padding: 1.5rem 0;
            margin-top: 3rem;
            border-top: 1px solid var(--border-color);
            color: var(--text-secondary-color);
            font-size: 0.9rem;
        }

        /* Responsive (match portfolio breakpoints) */
        @media (max-width: 768px) {
            .nav-container {
                flex-direction: row;
                flex-wrap: wrap;
                align-items: center;
                gap: 0.5rem 1rem;
                justify-content: space-between;
            }

            header nav {
                margin-left: 0;
                margin-right: 0;
                text-align: left;
                width: 100%;
                order: 3;
                flex-basis: 100%;
            }

                header nav ul {
                    justify-content: flex-start;
                    gap: 0.8rem;
                    flex-wrap: wrap;
                    display: flex;
                }

            .theme-toggle {
                order: 2;
            }

            main {
                padding-top: 120px;
            }
        }

        @media (max-width: 600px) {
            .nav-container {
                gap: 0.5rem;
            }

            header nav ul {
                gap: 0.5rem;
            }

            .page-title h1 {
                font-size: 1.7rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="nav-container">
            <div class="logo-and-icons">
                <div class="nav-logo">Oliver Neal</div>
                <div class="nav-icons">
                    <a href="https://github.com/OliverNealDev" target="_blank" title="GitHub">
                        <img src="github-icon.webp" alt="GitHub" onerror="this.style.display='none'" loading="lazy" />
                    </a>
                    <a href="https://embitgames.itch.io" target="_blank" title="Itch.io">
                        <img src="itch-icon.webp" alt="Itch.io" onerror="this.style.display='none'" loading="lazy" />
                    </a>
                    <a href="https://www.linkedin.com/in/oliver-neal-197b74290/" target="_blank" title="LinkedIn">
                        <img src="linkedin-icon.webp" alt="LinkedIn" onerror="this.style.display='none'" loading="lazy" />
                    </a>
                </div>
            </div>
            <nav>
                <ul>
                    <!-- Link back to anchors on the main portfolio for identical nav behavior 
                    <li><a href="index.html#about">About</a></li>
                    <li><a href="index.html#skills">Skills</a></li>
                    <li><a href="index.html#solo-projects" class="active-nav">Solo</a></li>
                    <li><a href="index.html#team-projects">Team</a></li>
                    <li><a href="index.html#education">Education</a></li>
                    <li><a href="index.html#contact">Contact</a></li>-->
                </ul>
            </nav>
            <div class="theme-toggle">
                <input type="checkbox" class="theme-checkbox" id="themeToggle" title="Toggle Theme">
            </div>
        </div>
    </header>

    <main>
        <!-- HERO -->
        <section class="page-hero reveal">
            <div class="breadcrumb">
                <span>←</span>
                <a href="index.html#solo-projects" title="Back to Portfolio">Back to Portfolio</a>
            </div>
            <div class="page-title">
                <h1>Minimalists – AI &amp; Node Control</h1>
                <p class="page-sub">Codebase Breakdown • Unity • ScriptableObjects • FSM AI</p>
            </div>
            <div class="doc-actions">
                <a href="https://embitgames.itch.io/minimalists" target="_blank" title="Play in browser" class="itchio">
                    <img src="itch-icon.webp" alt="Itch icon" onerror="this.style.display='none'" loading="lazy" /> Play in browser
                </a>
                <a href="https://github.com/OliverNealDev/Minimalists" target="_blank" title="View GitHub" class="github">
                    <img src="github-icon.webp" alt="GitHub icon" onerror="this.style.display='none'" loading="lazy" /> View on GitHub
                </a>
            </div>
        </section>

        <!-- Local TOC -->
        <nav class="doc-toc reveal" aria-label="On this page">
            <a href="#overview">Overview</a>
            <a href="#architecture">Architecture</a>
            <a href="#data-model">Data Model</a>
            <a href="#apis">Key APIs</a>
            <a href="#snippets">Code Snippets</a>
            <a href="#performance">Performance</a>
            <a href="#testing">Testing</a>
            <a href="#tradeoffs">Trade-offs</a>
        </nav>

        <div class="doc-grid">
            <!-- OVERVIEW -->
            <section id="overview" class="doc-card reveal">
                <h2>Overview</h2>
                <p>
                    A minimalist real-time strategy prototype where houses, turrets and helipads collaborate through dynamic node control and streamlined AI.
                    Built with Unity and data-driven <strong>ScriptableObjects</strong> to stay highly moddable and fast.
                </p>
            </section>

            <!-- ARCHITECTURE -->
            <section id="architecture" class="doc-card reveal">
                <h2>Architecture</h2>
                <p>Core systems are divided between client input, game loop, and combat/economy services.</p>
                <figure class="doc-figure">
                    <img src="docs/diagrams/minimalists-architecture.svg" alt="Architecture diagram" loading="lazy" />
                    <figcaption>High-level architecture</figcaption>
                </figure>

                <h3>Unit Command Sequence</h3>
                <figure class="doc-figure">
                    <img src="docs/diagrams/minimalists-sequence.svg" alt="Unit command sequence diagram" loading="lazy" />
                    <figcaption>Sequence from input → validation → spawn/stream → resolve</figcaption>
                </figure>
            </section>

            <!-- DATA MODEL -->
            <section id="data-model" class="doc-card reveal">
                <h2>Data Model</h2>
                <p>The game leans on data-driven ScriptableObjects so designers can tune balance without touching code.</p>
                <div class="doc-table-wrapper">
                    <table>
                        <thead>
                            <tr><th>Field</th><th>Type</th><th>Description</th></tr>
                        </thead>
                        <tbody>
                            <tr><td>constructName</td><td>string</td><td>Display name of the structure</td></tr>
                            <tr><td>upgradeCost</td><td>int</td><td>Units required to upgrade</td></tr>
                            <tr><td>maxUnitCapacity</td><td>int</td><td>Population provided by this construct</td></tr>
                            <tr><td>unitsPerSecond</td><td>float</td><td>Passive unit generation rate</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- APIs / CONTRACTS -->
            <section id="apis" class="doc-card reveal">
                <h2>Key APIs / Contracts</h2>

                <h3>Game Manager</h3>
                <pre><code class="language-csharp">public class GameManager : MonoBehaviour
{
    public void registerUnit(UnitController unit);
    public void unregisterUnit(UnitController unit);
}</code></pre>

                <h3>Construct Controller</h3>
                <pre><code class="language-csharp">public class ConstructController : MonoBehaviour
{
    public void SendUnits(ConstructController target, float percentage);
}</code></pre>
            </section>

            <!-- REPRESENTATIVE SNIPPETS -->
            <section id="snippets" class="doc-card reveal">
                <h2>Representative Code Snippets</h2>

                <p><strong>Map analysis assigns roles to each node</strong> – uses distance percentages to classify frontline, support and economic nodes.</p>
                <details>
                    <summary>Show code</summary>
<pre><code class="language-csharp">@AIManager7.cs lines 66-103
private void AnalyzeMapAndAssignRoles(List&lt;ConstructController&gt; myNodes)
{
    nodeRoles.Clear();
    var enemyNodes = GameManager.Instance.allConstructs
        .Where(c =&gt; c.Owner != aiFaction &amp;&amp; c.Owner != GameManager.Instance.unclaimedFaction)
        .ToList();

    // If no enemies exist or we have too few nodes for complex roles, they are all economic.
    if (!enemyNodes.Any() || myNodes.Count &lt;= 2)
    {
        myNodes.ForEach(n =&gt; nodeRoles[n] = NodeRole.Economic);
        return;
    }

    Vector3 enemyCenter = GetFactionCenter(enemyNodes);

    // Sort nodes by their distance to the enemy's center of mass.
    var sortedNodes = myNodes.OrderBy(n =&gt; Vector3.Distance(n.transform.position, enemyCenter)).ToList();

    int nodeCount = sortedNodes.Count;
    // Designate roles by percentage: closest 30% are Frontline, next 40% are Support, rest are Economic.
    int frontlineCount = Mathf.Max(1, Mathf.CeilToInt(nodeCount * 0.3f));
    int supportCount = Mathf.CeilToInt(nodeCount * 0.4f);

    for (int i = 0; i &lt; nodeCount; i++)
    {
        ConstructController currentNode = sortedNodes[i];
        if (i &lt; frontlineCount)
        {
            nodeRoles[currentNode] = NodeRole.Frontline;
        }
        else if (i &lt; frontlineCount + supportCount)
        {
            nodeRoles[currentNode] = NodeRole.Support;
        }
        else
        {
            nodeRoles[currentNode] = NodeRole.Economic;
        }
    }
}</code></pre>
                </details>
                <p><a href="https://github.com/OliverNealDev/Minimalists/blob/main/Assets/Scripts/AIManager7.cs#L66-L103" target="_blank">View on GitHub (lines 66–103)</a></p>

                <p><strong>Streaming units between nodes</strong> – validates targets and spawns units along the current movement system.</p>
                <details>
                    <summary>Show code</summary>
<pre><code class="language-csharp">@ConstructController.cs lines 415-450
public void SendUnits(ConstructController target, float percentage)
{
    bool isValidTarget = true;
    foreach (ConstructController construct in targetConstructs)
    {
        if (construct == target)
        {
            isValidTarget = false;
            break;
        }
    }

    if (!isValidTarget) return;

    int unitsToSend = Mathf.FloorToInt(UnitCount * percentage);
    if (unitsToSend == 0 &amp;&amp; UnitCount &gt; 0)
    {
        unitsToSend = 1;
    }
    if (unitsToSend &gt; 0)
    {
        if (currentConstructData is HelipadData)
        {
            targetConstructs.Add(target);
            StartCoroutine(SpawnUnitsRoutine(unitsToSend, target));
        }
        else
        {
            if (navmeshIndex == target.navmeshIndex)
            {
                targetConstructs.Add(target);
                StartCoroutine(SpawnUnitsRoutine(unitsToSend, target));
            }
        }
    }
}</code></pre>
                </details>
                <p><a href="https://github.com/OliverNealDev/Minimalists/blob/main/Assets/Scripts/ConstructController.cs#L415-L450" target="_blank">View on GitHub (lines 415–450)</a></p>
            </section>

            <!-- PERFORMANCE -->
            <section id="performance" class="doc-card reveal">
                <h2>Performance Notes</h2>
                <p>Profiling is ongoing and formal benchmarks are not yet published.</p>
            </section>

            <!-- TESTING -->
            <section id="testing" class="doc-card reveal">
                <h2>Testing &amp; Validation</h2>
                <p>Currently verified through manual playtesting; no automated tests are in place.</p>
            </section>

            <!-- TRADEOFFS -->
            <section id="tradeoffs" class="doc-card reveal">
                <h2>Trade-offs &amp; Next Steps</h2>
                <ul style="margin-left:1.25rem;">
                    <li>Finite state AI is easy to reason about; behavior trees could scale variety later.</li>
                    <li>Current movement/streaming approach is lightweight but has limited dynamic-obstacle handling, only works reliably for static obstacles.</li>
                    <li>Data-driven design simplifies scalability but can potentially be detrimental for systems that dont necessarily need it.</li>
                </ul>
            </section>
        </div>
    </main>

    <footer>
        &copy; 2025 Oliver Neal. All rights reserved.
    </footer>

    <!-- Prism -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-csharp.min.js" defer></script>

    <script defer>
        // Small utilities
        function throttle(func, limit) {
            let lastFunc; let lastRan;
            return function (...args) {
                const context = this;
                if (!lastRan) { func.apply(context, args); lastRan = Date.now(); }
                else {
                    clearTimeout(lastFunc);
                    lastFunc = setTimeout(function () {
                        if ((Date.now() - lastRan) >= limit) { func.apply(context, args); lastRan = Date.now(); }
                    }, limit - (Date.now() - lastRan));
                }
            }
        }

        // Theme (identical behavior to index)
        const themeToggle = document.getElementById('themeToggle');
        const html = document.documentElement;
        function applyTheme(theme) {
            if (theme === 'light') { html.classList.add('light-theme'); themeToggle.checked = true; }
            else { html.classList.remove('light-theme'); themeToggle.checked = false; }
        }
        const savedTheme = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const initialTheme = savedTheme ? savedTheme : (prefersDark ? 'dark' : 'light');
        applyTheme(initialTheme);
        themeToggle.addEventListener('change', () => {
            const newTheme = themeToggle.checked ? 'light' : 'dark';
            applyTheme(newTheme);
            localStorage.setItem('theme', newTheme);
        });

        // Reveal on scroll (match index)
        function revealSections() {
            const reveals = document.querySelectorAll('.reveal');
            const windowHeight = window.innerHeight;
            const elementVisibleThreshold = 100;
            reveals.forEach(el => {
                const elementTop = el.getBoundingClientRect().top;
                if (elementTop < windowHeight - elementVisibleThreshold) {
                    el.classList.add('visible');
                }
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            revealSections();
        });
        window.addEventListener('scroll', throttle(revealSections, 150));
    </script>
</body>
</html>
